-starteplayerscripts
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

local RemoteEvents = ReplicatedStorage:WaitForChild("RemoteEvents")
local DireccionHabilidadEvent = RemoteEvents:WaitForChild("DireccionHabilidad")

-- Variable para almacenar la posición objetivo actual
local PosicionObjetivo = Vector3.new(0, 0, 0)
local UltimaPosicionEnviada = PosicionObjetivo
local UltimoTiempoEnvio = 0

-- Función para detectar si es dispositivo móvil
local function IsMobile()
	return UserInputService.TouchEnabled and not UserInputService.MouseEnabled
end

-- Función para normalizar un vector (asegurar que tenga longitud 1)
local function normalizarVector(vector)
	local magnitud = vector.Magnitude
	if magnitud > 0 then
		return vector / magnitud
	else
		return Vector3.new(0, 0, 1)
	end
end

-- Actualizar la posición objetivo continuamente (solo en PC)
if not IsMobile() then
	RunService.RenderStepped:Connect(function()
		local character = LocalPlayer.Character
		local hrp = character and character:FindFirstChild("HumanoidRootPart")

		if hrp and Mouse then
			-- Usar la posición de impacto del mouse en el mundo
			PosicionObjetivo = Mouse.Hit.Position

			-- Enviar al servidor si la posición cambió significativamente
			local tiempoActual = tick()
			if (PosicionObjetivo - UltimaPosicionEnviada).Magnitude > 0.5 or tiempoActual - UltimoTiempoEnvio > 0.5 then
				DireccionHabilidadEvent:FireServer(PosicionObjetivo)
				UltimaPosicionEnviada = PosicionObjetivo
				UltimoTiempoEnvio = tiempoActual
			end
		end
	end)
else
	-- En móvil: usar la dirección frontal del personaje
	RunService.RenderStepped:Connect(function()
		local character = LocalPlayer.Character
		local hrp = character and character:FindFirstChild("HumanoidRootPart")

		if hrp then
			local direccion = normalizarVector(hrp.CFrame.LookVector)
			PosicionObjetivo = hrp.Position + direccion * 10

			local tiempoActual = tick()
			if (PosicionObjetivo - UltimaPosicionEnviada).Magnitude > 0.5 or tiempoActual - UltimoTiempoEnvio > 0.5 then
				DireccionHabilidadEvent:FireServer(PosicionObjetivo)
				UltimaPosicionEnviada = PosicionObjetivo
				UltimoTiempoEnvio = tiempoActual
			end
		end
	end)
end